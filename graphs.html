

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Graphs &mdash; pliers 0.4.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Results" href="results.html" />
    <link rel="prev" title="Transformers" href="transformers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pliers
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing pliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-concepts.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="stimuli.html">Stims</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformers.html">Transformers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Graphs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#graph-specification">Graph specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-graph-api">The Graph API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#node-specification">Node specification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#nesting">Nesting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-stuff">Other stuff</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#json-specification">JSON specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting">Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuring pliers</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Pliers API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pliers</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Graphs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/graphs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="graphs">
<h1>Graphs<a class="headerlink" href="#graphs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="graph-specification">
<h2>Graph specification<a class="headerlink" href="#graph-specification" title="Permalink to this headline">¶</a></h2>
<p>To this point, we’ve been initializing and running our Transformers one at a time, and explicitly passing stimuli to each one. While this works fine, it can get rather verbose in cases where we want to extract a large number of features. It can also be a bit of a pain to appropriately connect Converters to one another when the routing is complicated.</p>
<p>For example, suppose we have a series of videos (perhaps segments of a full-length movie), and we want to extract both visual and speech transcript-based features. Specifically, let’s say we want to detect faces in the frames of the video, and also run a sentiment analysis model on a speech transcription extracted from the audio track of the videos. This requires us to do all of the following:</p>
<ul class="simple">
<li><p>Convert the video to a series of video frames (i.e., static images), probably with some periodic sampling (there’s no point in running face detection on every single frame, since subtitles won’t change nearly that fast—we can probably get away with sampling frames as little as twice per second);</p></li>
<li><p>Run face detection on each extracted frame (we’ll use Google’s Cloud Vision face detection API);</p></li>
<li><p>Extract the audio track from the video;</p></li>
<li><p>Transcribe the audio track to text (we’ll use Google’s Cloud Speech API for this);</p></li>
</ul>
<p>The code to do this, with transformations made explicit:</p>
<div class="literal-block-wrapper docutils container" id="listing-1">
<div class="code-block-caption"><span class="caption-text">Listing 1</span><a class="headerlink" href="#listing-1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pliers.stimuli</span> <span class="kn">import</span> <span class="n">VideoStim</span>
<span class="kn">from</span> <span class="nn">pliers.filters</span> <span class="kn">import</span> <span class="n">FrameSamplingFilter</span>
<span class="kn">from</span> <span class="nn">pliers.converters</span> <span class="kn">import</span> <span class="n">GoogleSpeechAPIConverter</span>
<span class="kn">from</span> <span class="nn">pliers.extractors</span> <span class="kn">import</span> <span class="p">(</span><span class="n">merge_results</span><span class="p">,</span> <span class="n">GoogleVisionAPIFaceExtractor</span><span class="p">)</span>

<span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;segment1.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;segment2.mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;segment3.mp4&#39;</span><span class="p">]</span>
<span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">VideoStim</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">]</span>

<span class="c1"># Sample 2 video frames / second</span>
<span class="n">frame_filter</span> <span class="o">=</span> <span class="n">FrameSamplingFilter</span><span class="p">(</span><span class="n">hertz</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">frame_filter</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

<span class="c1"># Face extraction</span>
<span class="n">face_ext</span> <span class="o">=</span> <span class="n">GoogleVisionAPIFaceExtractor</span><span class="p">()</span>
<span class="n">face_results</span> <span class="o">=</span> <span class="n">face_ext</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span>

<span class="c1"># Run each image through Google&#39;s text detection API</span>
<span class="n">transcriber</span> <span class="o">=</span> <span class="n">GoogleSpeechAPIConverter</span><span class="p">()</span>
<span class="n">transcripts</span> <span class="o">=</span> <span class="n">transcriber</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

<span class="c1"># # Apply Indico sentiment analysis extractor</span>
<span class="n">indico</span> <span class="o">=</span> <span class="n">IndicoAPITextExtractor</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">])</span>
<span class="n">sentiment_results</span> <span class="o">=</span> <span class="n">indico</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">transcripts</span><span class="p">)</span>

<span class="c1"># Combine visual and text-based feature data</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">face_results</span> <span class="o">+</span> <span class="n">sentiment_results</span>

<span class="c1"># # Merge into a single pandas DF</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">merge_results</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-graph-api">
<h2>The Graph API<a class="headerlink" href="#the-graph-api" title="Permalink to this headline">¶</a></h2>
<p>The above code really isn’t that bad–it already features a high level of abstraction (each <code class="xref py py-class docutils literal notranslate"><span class="pre">Transformer</span></code> is initialized and applied in just two lines of code!), and has the advantage of being explicit about every step. Nonetheless, if we want to save ourselves a few dozen keystrokes, we can use pliers’ <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> API to abbreviate the listing down to just this:</p>
<div class="literal-block-wrapper docutils container" id="listing-2">
<div class="code-block-caption"><span class="caption-text">Listing 2</span><a class="headerlink" href="#listing-2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pliers.graph</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">from</span> <span class="nn">pliers.filters</span> <span class="kn">import</span> <span class="n">FrameSamplingFilter</span>
<span class="kn">from</span> <span class="nn">pliers.extractors</span> <span class="kn">import</span> <span class="n">IndicoAPITextExtractor</span>

<span class="c1"># Define nodes</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">FrameSamplingFilter</span><span class="p">(</span><span class="n">hertz</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;GoogleVisionAPIFaceExtractor&#39;</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">&#39;GoogleSpeechAPIConverter&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">IndicoAPITextExtractor</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">])])</span>
<span class="p">]</span>

<span class="c1"># Construct and run Graph</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="node-specification">
<h3>Node specification<a class="headerlink" href="#node-specification" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a> produces exactly the same result as in <a class="reference internal" href="#listing-1"><span class="std std-ref">Listing 1</span></a>. But instead of explicitly initializing and applying each <code class="xref py py-class docutils literal notranslate"><span class="pre">Transformer</span></code> in sequence, all of the important work is done in the compact node specification. A detailed explanation of the node specification format can be found in the <code class="xref py py-func docutils literal notranslate"><span class="pre">add_nodes()</span></code> docstring. For present purposes, the key thing to recognize is that each node in the above graph is represented as a tuple with 2 elements. In this case, there are two root nodes–one for image processing (face extraction), the other for speech processing (sentiment analysis on the transcribed text). The first element in each <code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code> definition indicates which Transformer to apply at that node. Here, the first node applies a <code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSamplingFilter</span></code>, and the second applies a <code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleSpeechAPIConverter</span></code>.</p>
<p>The second element in each tuple contains any children nodes-—i.e., nodes to which the output of the Transformer specified in the first node are passed. In our case, each node has only one child: the <code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSamplingFilter</span></code> passes its output to the <code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleVisionAPIFaceExtractor</span></code>, and the <code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleSpeechAPIConverter</span></code> passes its output to the <a href="#id1"><span class="problematic" id="id2">|IndicoAPITextExtractor|</span></a>. However, in principle, the list of children nodes can be arbitrarily large. For example, we could have written:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">FrameSamplingFilter</span><span class="p">(</span><span class="n">hertz</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">[</span><span class="s1">&#39;GoogleVisionAPIFaceExtractor&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ClarifaiAPIImageExtractor&#39;</span><span class="p">,</span>
         <span class="s1">&#39;GoogleVisionAPILabelExtractor&#39;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In this case, we would have a single root node, and the output of the <code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSamplingFilter</span></code> would be independently passed to three separate extractors–the Google Vision face extractor, the Clarifai object labelling extractor, and the Google Vision label extractor.</p>
<div class="section" id="nesting">
<h4>Nesting<a class="headerlink" href="#nesting" title="Permalink to this headline">¶</a></h4>
<p>We can also nest additional levels by replacing each string value in the child list with another tuple. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">FrameSamplingFilter</span><span class="p">(</span><span class="n">hertz</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;GoogleVisionAPITextConverter&#39;</span><span class="p">,</span>
                <span class="p">[</span>
                        <span class="n">IndicoAPITextExtractor</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">])</span>
                <span class="p">])</span>
         <span class="p">]</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Here, we’re passing video frames to the <code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleVisionAPITextConverter</span></code>, which detects text labels within images. Any resulting <code class="xref py py-class docutils literal notranslate"><span class="pre">TextStim</span></code> objects are then passed onto the <a href="#id3"><span class="problematic" id="id4">|IndicoAPITextExtractor|</span></a> for sentiment analysis. Using this simple syntax, we can quickly construct Graphs with arbitrarily deep nestings.</p>
</div>
<div class="section" id="other-stuff">
<h4>Other stuff<a class="headerlink" href="#other-stuff" title="Permalink to this headline">¶</a></h4>
<p>There are two other points worth noting about the <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> specification. First, note that we don’t need to explicitly specify most <code class="xref py py-class docutils literal notranslate"><span class="pre">Stim</span></code> conversion steps, as these will generally be detected and injected automatically (though, laziness aside, it’s generally a good idea to be explicit). In <a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a>, we never had to specify the <code class="xref py py-class docutils literal notranslate"><span class="pre">VideoToAudioConverter</span></code> that strips the audio track from the input videos; pliers did the work for us implicitly.</p>
<p>Second, observe that we can define nodes using string values rather than initialized <code class="xref py py-class docutils literal notranslate"><span class="pre">Transformer</span></code> objects. For example, in <a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a>, instead of passing an initialized <code class="docutils literal notranslate"><span class="pre">GoogleVisionAPIFaceExtractor()</span></code> object, we pass the string <code class="docutils literal notranslate"><span class="pre">'GoogleVisionAPIFaceExtractor'</span></code> (we could also have passed <code class="docutils literal notranslate"><span class="pre">'googlevisionapifaceextractor'</span></code>, as the specification is case-insensitive). This only works in cases where we don’t need to pass non-default arguments, however.</p>
</div>
</div>
<div class="section" id="json-specification">
<h3>JSON specification<a class="headerlink" href="#json-specification" title="Permalink to this headline">¶</a></h3>
<p>A convenient feature of the graph API illustrated in <a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a> is that the list of nodes can be easily serialized as plain text. This allows us to conveniently encode the above graph specification as the following JSON:</p>
<div class="literal-block-wrapper docutils container" id="listing-3">
<div class="code-block-caption"><span class="caption-text">Listing 3</span><a class="headerlink" href="#listing-3" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>nodes = {
    &#39;roots&#39;: [
        {
            &#39;transformer&#39;: &#39;FrameSamplingConverter&#39;,
            &#39;parameters&#39;: {
                &#39;hertz&#39;: 2
            },
            &#39;children&#39;: [
                {
                    &#39;transformer&#39;: &#39;GoogleVisionAPIFaceExtractor&#39;
                }
            ]
        },
        {
            &#39;transformer&#39;: &#39;GoogleSpeechAPIConverter&#39;,
            &#39;children&#39;: [
                {
                    &#39;transformer&#39;: &#39;IndicoAPITextExtractor&#39;,
                    &#39;parameters&#39;: {
                        &#39;models&#39;: [&#39;sentiment&#39;]
                    }
                }
            ]
        }
    ]
}
</pre></div>
</div>
</div>
<p>We can then construct a <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> simply by passing in the path to the JSON file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="s1">&#39;graph_spec.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note one important difference between the Python specification and the JSON specification: we obviously can’t serialize the already-initialized <code class="xref py py-class docutils literal notranslate"><span class="pre">FrameSamplingFilter</span></code> in the Python listing as plain text. This means that for Transformers that we want to initialize with non-default arguments, we need to separate the parameters separately, as in the JSON example above.</p>
</div>
<div class="section" id="plotting">
<h3>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h3>
<p>To facilitate understanding and verification of <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code>s–which can get complicated in a hurry if a lot of implicit conversion is happening–the <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> class provides rudimentary plotting capabilities. Provided graphiz and PyGraphviz are available, calling <code class="code py python docutils literal notranslate"><span class="name"><span class="pre">graph</span></span><span class="operator"><span class="pre">.</span></span><span class="name"><span class="pre">draw</span></span><span class="punctuation"><span class="pre">(</span></span><span class="name"><span class="pre">filename</span></span><span class="punctuation"><span class="pre">)</span></span></code> on any initialized <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> will generate a simple visual representation of the Graph. For our running example (<a class="reference internal" href="#listing-2"><span class="std std-ref">Listing 2</span></a>), the result looks like this:</p>
<img alt="_images/graph.png" src="_images/graph.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="results.html" class="btn btn-neutral float-right" title="Results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="transformers.html" class="btn btn-neutral float-left" title="Transformers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Developers of pliers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>